(()=>{var e,t,o,n,a,i={428:e=>{"use strict";e.exports=window.jQuery},383:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,o)=>{var n=o(736);function a(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}e.exports=function(e,t,o){return t&&a(e.prototype,t),o&&a(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},45:(e,t,o)=>{var n=o(738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var a=o.call(e,t||"default");if("object"!=n(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},736:(e,t,o)=>{var n=o(738).default,a=o(45);e.exports=function(e){var t=a(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(o){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(o)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return i[e](o,o.exports,s),o.exports}e=s(994),t=e(s(383)),o=e(s(579)),n=e(s(428)),a=function(){return(0,o.default)((function e(o){(0,t.default)(this,e),this.params=o,this.prefix="#"+(0,n.default)("#wc_stripe_prefix").val()}),[{key:"init",value:function(){(0,n.default)('[name^="woocommerce_stripe"]').on("change",this.display_children.bind(this)),(0,n.default)("select.stripe-accepted-cards").on("select2:select",this.reorder_multiselect),(0,n.default)(".api-register-domain").on("click",this.register_domain.bind(this)),(0,n.default)(".wc-stripe-create-webhook").on("click",this.manage_webhook.bind(this)),(0,n.default)(".wc-stripe-connection-test").on("click",this.do_connection_test.bind(this)),(0,n.default)(".stripe-delete-connection").on("click",this.do_delete_connection.bind(this)),(0,n.default)(document.body).on("change",".payment-method-config-options",this.fetchPaymentMethodConfigSettings.bind(this)),(0,n.default)(document.body).on("click",".add-new-payment-config",this.renderPaymentConfigModal.bind(this)),(0,n.default)(document.body).on("click","#create-payment-config",this.createPaymentMethodConfig.bind(this)),(0,n.default)(document.body).on("click",".refresh-payment-config",this.refreshPaymentConfig.bind(this)),"undefined"!=typeof wc_stripe_admin_notices&&this.display_notices(),this.display_children(),window.location.search.match(/_stripe_connect_nonce/)&&history.pushState({},"",window.location.pathname+"?page=wc-settings&tab=checkout&section=stripe_api"),(0,n.default)(document.body).on("submit","#mainform",this.validateForm.bind(this))}},{key:"display_children",value:function(e){(0,n.default)("[data-show-if]").each(function(e,t){var o=(0,n.default)(t),a=o.data("show-if"),i=[];n.default.each(a,function(e,t){var a=(0,n.default)(this.prefix+e);-1==i.indexOf(o.attr("id"))?a.is(":checkbox")?a.is(":checked")==t?o.closest("tr").show():(o.closest("tr").hide(),i.push(o.attr("id"))):a.val()==t?o.closest("tr").show():(o.closest("tr").hide(),i.push(o.attr("id"))):(o.closest("tr").hide(),i.push(o.attr("id")))}.bind(this))}.bind(this))}},{key:"reorder_multiselect",value:function(e){var t=e.params.data.element,o=(0,n.default)(t);o.detach(),(0,n.default)(this).append(o),(0,n.default)(this).trigger("change")}},{key:"register_domain",value:function(e){var t=this;e.preventDefault(),this.block(),n.default.ajax({url:this.params.routes.apple_domain,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,hostname:window.location.hostname}}).done((function(e){t.unblock(),e.code,window.alert(e.message)})).fail((function(e,o,n){t.unblock(),window.alert(n)}))}},{key:"manage_webhook",value:function(e){e.preventDefault(),(0,n.default)(e.currentTarget).is(".wc-stripe-delete-webhook")?this.delete_webhook():this.create_webhook()}},{key:"create_webhook",value:function(){var e=this;this.block();var t=(0,n.default)("#woocommerce_stripe_api_mode").val();n.default.ajax({url:this.params.routes.create_webhook,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,environment:t}}).done((function(o){e.unblock(),o.code?window.alert(o.message):((0,n.default)("#woocommerce_stripe_api_webhook_secret_"+t).val(o.secret),window.alert(o.message),window.location.reload())})).fail((function(t,o,n){e.unblock(),window.alert(n)}))}},{key:"delete_webhook",value:function(){this.block();var e=(0,n.default)("#woocommerce_stripe_api_mode").val();n.default.ajax({url:this.params.routes.delete_webhook,dataType:"json",method:"POST",data:{_wpnonce:this.params.rest_nonce,mode:e}}).done(function(t){this.unblock(),t.code?window.alert(t.message):((0,n.default)("#woocommerce_stripe_api_webhook_secret_"+e).val(""),window.location.reload())}.bind(this)).fail(function(e,t,o){this.unblock(),window.alert(o)}.bind(this))}},{key:"do_connection_test",value:function(e){var t=this;e.preventDefault(),this.block();var o,a=(0,n.default)("#woocommerce_stripe_api_mode").val();n.default.ajax({url:this.params.routes.connection_test,dataType:"json",method:"POST",data:(o={_wpnonce:t.params.rest_nonce,mode:a},"test"===a&&(o.secret_key=(0,n.default)("#woocommerce_stripe_api_secret_key_test").val(),o.publishable_key=(0,n.default)("#woocommerce_stripe_api_publishable_key_test").val()),o)}).done((function(e){t.unblock(),e.code,window.alert(e.message)})).fail((function(e,o,n){t.unblock(),window.alert(n)}))}},{key:"display_notices",value:function(){n.default.each(wc_stripe_admin_notices,function(e,t){(0,n.default)(".woo-nav-tab-wrapper").after(t)}.bind(this))}},{key:"block",value:function(){(0,n.default)(".wc-stripe-settings-container").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}},{key:"unblock",value:function(){(0,n.default)(".wc-stripe-settings-container").unblock()}},{key:"do_delete_connection",value:function(e){e.preventDefault(),confirm(this.params.messages.delete_connection)&&(this.block(),n.default.ajax({method:"POST",url:this.params.routes.delete_connection,dataType:"json",data:{_wpnonce:this.params.rest_nonce}}).done(function(e){this.unblock(),e.code?window.alert(e.message):window.location.reload()}.bind(this)).fail(function(){this.unblock()}.bind(this)))}},{key:"createPaymentMethodConfig",value:function(e){e.preventDefault();var t=(0,n.default)(e.currentTarget),o=t.text();t.text(this.params.messages.create).prop("disabled",!0),n.default.ajax({method:"POST",url:this.params.routes.create_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,name:(0,n.default)("#payment_config_name").val()}}).done((function(e){t.text(o).prop("disabled",!1),e.code?window.alert(e.message):((0,n.default)(".wc-stripe-settings-container").replaceWith(e.html),(0,n.default)(document.body).trigger("wc-enhanced-select-init"),(0,n.default)(".modal-close").click())})).fail((function(){t.text(o).prop("disabled",!1)}))}},{key:"fetchPaymentMethodConfigSettings",value:function(e){var t=this;this.block();var o=(0,n.default)("#woocommerce_stripe_upm_enabled").is(":checked");n.default.ajax({method:"POST",url:this.params.routes.fetch_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,payment_config:(0,n.default)(e.currentTarget).val()}}).done((function(e){t.unblock(),e.code?window.alert(e.message):((0,n.default)(".wc-stripe-settings-container").replaceWith(e.html),(0,n.default)("#woocommerce_stripe_upm_enabled").prop("checked",o),(0,n.default)(document.body).trigger("wc-enhanced-select-init"),(0,n.default)(".modal-close").click())})).fail((function(){t.unblock()}))}},{key:"renderPaymentConfigModal",value:function(e){e.preventDefault(),(0,n.default)(e.currentTarget).WCBackboneModal({template:"wc-stripe-modal-payment-config",variable:""})}},{key:"validateForm",value:function(e){if((0,n.default)(".wc-stripe-settings-container").hasClass("stripe_upm")&&""===(0,n.default)(".payment-method-config-options").val())return window.alert(this.params.messages.upm_validation),!1}},{key:"refreshPaymentConfig",value:function(e){e.preventDefault();var t=(0,n.default)(e.currentTarget);t.prop("disabled",!0).find("span").addClass("processing"),n.default.ajax({method:"POST",url:this.params.routes.refresh_payment_method_config,dataType:"json",data:{_wpnonce:this.params.rest_nonce,payment_config:(0,n.default)(e.currentTarget).val()}}).done((function(e){t.prop("disabled",!1).find("span").removeClass("processing"),e.code?window.alert(e.message):((0,n.default)(".wc-stripe-settings-container").replaceWith(e.html),(0,n.default)(document.body).trigger("wc-enhanced-select-init"))})).fail((function(){t.prop("disabled",!1).find("span").removeClass("processing")}))}}])}(),(0,n.default)((function(){new a(wc_stripe_setting_params).init()}))})();
//# sourceMappingURL=admin-settings.js.map